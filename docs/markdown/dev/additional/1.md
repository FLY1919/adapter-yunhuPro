# 附录：消息事件示例

本文档提供了云湖机器人接收到的不同类型消息事件的 JSON 结构示例。

## 普通消息

当机器人在群组或私聊中收到普通消息时，会触发此事件。

### 文本消息

最基础的文本消息。

**关键字段说明**

| 字段路径                     | 类型     | 描述                 | 示例值                               |
| ---------------------------- | -------- | -------------------- | ------------------------------------ |
| `header.eventType`           | `string` | 事件类型             | `message.receive.normal`             |
| `event.sender.senderId`      | `string` | 发送者 ID            | `"7756242"`                          |
| `event.chat.chatId`          | `string` | 会话 ID (群组或用户) | `"307149245"`                        |
| `event.message.msgId`        | `string` | 消息的唯一 ID        | `"930a7bad5d8144c5b25bc161031bb82b"` |
| `event.message.contentType`  | `string` | 消息内容类型         | `"text"`                             |
| `event.message.content.text` | `string` | 消息的文本内容       | `"这是一条普通消息"`                 |

<details>
<summary>完整 JSON 示例</summary>

```json
{
    "version": "1.0",
    "header": {
        "eventId": "d1ae39a31063408099b5961ed637f10c",
        "eventType": "message.receive.normal",
        "eventTime": 1761214759404
    },
    "event": {
        "sender": {
            "senderId": "7756242",
            "senderType": "user",
            "senderUserLevel": "owner",
            "senderNickname": "小学不在这里哦"
        },
        "chat": {
            "chatId": "307149245",
            "chatType": "group"
        },
        "message": {
            "msgId": "930a7bad5d8144c5b25bc161031bb82b",
            "parentId": "",
            "sendTime": 1761214759381,
            "chatId": "307149245",
            "chatType": "group",
            "contentType": "text",
            "content": {
                "text": "这是一条普通消息",
                "menu": {
                    "": "北京"
                }
            },
            "instructionId": 0,
            "instructionName": "",
            "commandId": 0,
            "commandName": ""
        }
    }
}
```

</details>

### 图片消息

包含图片的消息。

**关键字段说明**

| 字段路径                            | 类型     | 描述            | 示例值          |
| ----------------------------------- | -------- | --------------- | --------------- |
| `event.message.contentType`         | `string` | 消息内容类型    | `"image"`       |
| `event.message.content.imageUrl`    | `string` | 图片的 URL      | `"https://..."` |
| `event.message.content.imageName`   | `string` | 图片文件名      | `"e4f...png"`   |
| `event.message.content.imageWidth`  | `number` | 图片宽度 (像素) | `512`           |
| `event.message.content.imageHeight` | `number` | 图片高度 (像素) | `465`           |

<details>
<summary>完整 JSON 示例</summary>

```json
{
    "version": "1.0",
    "header": {
        "eventId": "1fe12e6f9ab942e39468c4de0de66bb0",
        "eventType": "message.receive.normal",
        "eventTime": 1761214895781
    },
    "event": {
        "sender": {
            "senderId": "7756242",
            "senderType": "user",
            "senderUserLevel": "owner",
            "senderNickname": "小学不在这里哦"
        },
        "chat": {
            "chatId": "307149245",
            "chatType": "group"
        },
        "message": {
            "msgId": "467066ccf64641ab84fb7a9f6d354959",
            "parentId": "",
            "sendTime": 1761214895677,
            "chatId": "307149245",
            "chatType": "group",
            "contentType": "image",
            "content": {
                "imageUrl": "https://chat-storage1.jwznb.com/e4f77d3729a7fc3e5040be276b3c569b.png?sign=9dcdb53f9eb836ad30bf6b966dc936b8&t=68fa0fbf",
                "imageName": "e4f77d3729a7fc3e5040be276b3c569b.png",
                "etag": "Fs4Kfnw0zx08tcXkZ7Blv56oqPXe",
                "imageWidth": 512,
                "imageHeight": 465,
                "menu": {
                    "": "北京"
                }
            },
            "instructionId": 0,
            "instructionName": "",
            "commandId": 0,
            "commandName": ""
        }
    }
}
```

</details>

## 指令消息

当用户通过指令菜单、或直接发送以 `/` 开头的文本与机器人交互时，会触发此事件。

### 直接指令

用户直接发送以 `/` 开头的文本触发的指令。

**关键字段说明**

| 字段路径                        | 类型     | 描述           | 示例值                        |
| ------------------------------- | -------- | -------------- | ----------------------------- |
| `header.eventType`              | `string` | 事件类型       | `message.receive.instruction` |
| `event.message.content.text`    | `string` | 消息的文本内容 | `"/这是直接发的指令"`         |
| `event.message.instructionId`   | `number` | 指令的唯一 ID  | `2103`                        |
| `event.message.instructionName` | `string` | 指令的名称     | `"这是直接发的指令"`          |

<details>
<summary>完整 JSON 示例</summary>

```json
{
    "version": "1.0",
    "header": {
        "eventId": "b2dc5986402545ce80a7bf5b862010c8",
        "eventType": "message.receive.instruction",
        "eventTime": 1761208476688
    },
    "event": {
        "sender": {
            "senderId": "7756242",
            "senderType": "user",
            "senderUserLevel": "owner",
            "senderNickname": "小学不在这里哦"
        },
        "chat": {
            "chatId": "37090343",
            "chatType": "bot"
        },
        "message": {
            "msgId": "5d6c47a6fc124653a67fa67c595ea08f",
            "parentId": "",
            "sendTime": 1761208476676,
            "chatId": "37090343",
            "chatType": "bot",
            "contentType": "text",
            "content": {
                "text": "/这是直接发的指令",
                "menu": {
                    "MW941CUD": "0",
                    "S5VCMYU4": "北京"
                }
            },
            "instructionId": 2103,
            "instructionName": "这是直接发的指令",
            "commandId": 2103,
            "commandName": "这是直接发的指令"
        }
    }
}
```

</details>

### 普通指令

用户点击指令菜单中的普通按钮触发的指令。

**关键字段说明**

| 字段路径                        | 类型     | 描述           | 示例值                          |
| ------------------------------- | -------- | -------------- | ------------------------------- |
| `event.message.content.text`    | `string` | 消息的文本内容 | `"这是普通指令的默认文字 饿啊"` |
| `event.message.instructionId`   | `number` | 指令的唯一 ID  | `2104`                          |
| `event.message.instructionName` | `string` | 指令的名称     | `"这是普通指令"`                |

<details>
<summary>完整 JSON 示例</summary>

```json
{
    "version": "1.0",
    "header": {
        "eventId": "86895467a4644819b4ba744ac1f44053",
        "eventType": "message.receive.instruction",
        "eventTime": 1761208548716
    },
    "event": {
        "sender": {
            "senderId": "7756242",
            "senderType": "user",
            "senderUserLevel": "owner",
            "senderNickname": "小学不在这里哦"
        },
        "chat": {
            "chatId": "37090343",
            "chatType": "bot"
        },
        "message": {
            "msgId": "4bfd90b450eb4c1daf63e9491d8d04c2",
            "parentId": "",
            "sendTime": 1761208548672,
            "chatId": "37090343",
            "chatType": "bot",
            "contentType": "text",
            "content": {
                "text": "这是普通指令的默认文字 饿啊",
                "menu": {
                    "MW941CUD": "0",
                    "S5VCMYU4": "北京"
                }
            },
            "instructionId": 2104,
            "instructionName": "这是普通指令",
            "commandId": 2104,
            "commandName": "这是普通指令"
        }
    }
}
```

</details>

### 自定义指令

用户通过指令菜单中的自定义输入表单触发的指令。

**关键字段说明**

| 字段路径                         | 类型     | 描述                          |
| -------------------------------- | -------- | ----------------------------- |
| `event.message.contentType`      | `string` | 消息内容类型，固定为 `"form"` |
| `event.message.content.formJson` | `object` | 用户提交的表单数据            |
| `event.message.instructionId`    | `number` | 指令的唯一 ID                 |
| `event.message.instructionName`  | `string` | 指令的名称                    |

<details>
<summary>完整 JSON 示例</summary>

```json
{
    "version": "1.0",
    "header": {
        "eventId": "f27ea6f554b347058852f55502b2d2b7",
        "eventType": "message.receive.instruction",
        "eventTime": 1761208636918
    },
    "event": {
        "sender": {
            "senderId": "7756242",
            "senderType": "user",
            "senderUserLevel": "owner",
            "senderNickname": "小学不在这里哦"
        },
        "chat": {
            "chatId": "37090343",
            "chatType": "bot"
        },
        "message": {
            "msgId": "e37a993ce328455caf6d5d9ae1d9d6ee",
            "parentId": "",
            "sendTime": 1761208636906,
            "chatId": "37090343",
            "chatType": "bot",
            "contentType": "form",
            "content": {
                "formJson": {
                    "loktny": {
                        "id": "loktny",
                        "type": "input",
                        "label": "这是自定义输入指令的标签",
                        "value": "这是自定义输入指令的标签的默认内容"
                    }
                },
                "menu": {
                    "MW941CUD": "0",
                    "S5VCMYU4": "北京"
                }
            },
            "instructionId": 2105,
            "instructionName": "这是自定义输入指令",
            "commandId": 2105,
            "commandName": "这是自定义输入指令"
        }
    }
}
```

</details>
